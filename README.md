# SocArXiv Bluesky Bot

This project builds on the [Bluesky bot template](https://github.com/philnash/bsky-bot) provided by Phil Nash - big thanks! to automatically fetch new PsyArXiv preprints via RSS and post summaries to Bluesky.

It uses TypeScript, the `@atproto/api`, and runs as a scheduled task.

---

## Reference

For general setup, environment variables and deployment, please refer to the original template which explain this in detail. This README focuses only on the logic and maintenance of this specific application. 

---

## What This Bot Does

* **Fetches ArXiv RSS feed**
  Uses [`rss-parser`](https://www.npmjs.com/package/rss-parser) to read from:
  `https://osfpreprints-feed.herokuapp.com/SocArXiv.rss`

* **Tracks already posted papers**
  Stores IDs of posted papers in `postedPapers.json` to avoid duplicates.

* **Formats Bluesky post text**
  For each new paper, creates a short post with the title and link.

* **Posts to Bluesky**
  Logs in using the configured Bluesky handle and password, then posts using the `@atproto/api`.

---

## Main Files and Logic

| File                 | Purpose                                                                               |
| -------------------- | ------------------------------------------------------------------------------------- |
| `src/config.ts`      | Loads environment variables for Bluesky login and service                             |
| `src/bot.ts`         | Handles Bluesky login and posting                                                     |
| `src/getPostText.ts` | Parses the RSS feed, filters out already-posted papers, and prepares post texts       |
| `src/index.ts`       | Main script: pulls new posts, sends them to Bluesky, and updates `postedPapers.json`  |
| `.github/workflows/post.yml` | GitHub Action that runs the bot automatically on schedule |

---

## Setup

The handle and the PW are set in the GitHub secrets of the repository (-> Settings ->secrets and variables -> actions). 
If you change the password or the handle of the bluesky accojunt you can just change the secrets there and the bot will continue to work.
Additionally there is the GH_PAT (GitHub personal access token) that is needed for the github actions to push the changes to the postedPapers.json file in order to save which papers have been posted.
This token can be generated in the general settings of the github account under settings/tokens and then needs to be copied into the secret. This token can only be generated by the owner of the repo.
Usually you do not need to change this token but in the case you want to, only the psydig account is able to do so.

1. **GitHub Secrets**:
   - `BSKY_HANDLE`: Bluesky handle
   - `BSKY_PASSWORD`: the app password for the bot
   - `GH_PAT`: GitHub personal access token (used for committing updates to `postedPapers.json`). 

Note, if you want to go back to run the bot manually look into the manual from Phil Nash, you will need to create an .env file with the passwords and the handle. 

2. **Dependencies**:

The .nvmrc file defines which Node.js version is used for the GitHub Actions (via the actions/setup-node step). If this version becomes outdated, it can be changed there. 
	
---

### Workflow details

- **Schedule**: runs every 30 minutes ("*/30 * * * *"). Check out https://crontab.guru to see how this works
  
- **What it does** (each run):
  1. Checks out the repository (with permission to push changes)
  2. Installs Node.js and dependencies
  3. Builds and runs the bot
  4. Updates the `postedPapers.json` file if new papers were posted
  5. Commits the updated file back to the repository to maintain state

---

## Maintenance Tips

- To **abort the bot**, simply delete the GitHub Action workflow file `.github/workflows/post.yml` or change the shedule to something that will not run in a long time (e.g. "* * * */12 *")
- In the past there where instances where the bot failed because the papers it tried to post where not compatible with the Bluesky API. For example there was one paper that had a very long title and the bot failed to post it. In cases like this it is better to change the bot s.t. it can handle such cases in the future. If for some reason you cannot figure out why a certain paper makes the bot fail you can manually add it to the postedPapers.json file. This is a list of all the papers that have been posted. Just check the format in which they are saved and copy/paste it from the RSS feed in there. This paper will then be ignored in the posting. 
- To **adjust post limits**, edit `MAX_POSTS_PER_RUN` in `getPostText.ts`. Note, there is a limit of posts one can post on Bluesky I think and therefore when it tries to post too many the Github Action fails and it then posts the same papers again and again because the action only posts them but it fails to then continue and store them as posted. Also, there is a character limit per post which is also handeled.
- To **change the feed**, update the `FEED_URL` in `getPostText.ts`
- To **change the posting frequency**, edit the `cron` schedule in `.github/workflows/post.yml`
- To **change the Bluesky account details**, update the GitHub Secrets
