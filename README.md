# SocArXiv Bluesky Bot

This project builds on the [Bluesky bot template](https://github.com/philnash/bsky-bot) provided by Phil Nash - big thanks! to automatically fetch new PsyArXiv preprints via RSS and post summaries to Bluesky.

It uses TypeScript, the `@atproto/api`, and runs as a scheduled task.

---

## Reference

For general setup, environment variables, GitHub Actions, and deployment, please refer to the original template README. This README focuses only on the ArXiv-specific logic and maintenance. 

---

## What This Bot Does

* **Fetches PsyArXiv RSS feed**
  Uses [`rss-parser`](https://www.npmjs.com/package/rss-parser) to read from:
  `https://osfpreprints-feed.herokuapp.com/PsyArXiv.rss`

* **Tracks already posted papers**
  Stores IDs of posted papers in `postedPapers.json` to avoid duplicates.

* **Formats Bluesky post text**
  For each new paper, creates a short post with the title and link.

* **Posts to Bluesky**
  Logs in using the configured Bluesky handle and password, then posts using the `@atproto/api`.

---

## Main Files and Logic

| File                 | Purpose                                                                               |
| -------------------- | ------------------------------------------------------------------------------------- |
| `src/config.ts`      | Loads environment variables for Bluesky login and service.                            |
| `src/bot.ts`         | Handles Bluesky login and posting.                                                    |
| `src/getPostText.ts` | Parses the RSS feed, filters out already-posted papers, and prepares post texts.      |
| `src/index.ts`       | Main script: pulls new posts, sends them to Bluesky, and updates `postedPapers.json`. |
| `.github/workflows/post.yml` | GitHub Action that runs the bot automatically on schedule. |

---

## Setup

The handle and the PW need to be set in the GitHub secrets of the repo (Settings/secrets and variables/actions).
Additionally there is the GH_PAT (GitHub personal access token) that is needed for the github actions to push the changes to the postedPapers.json file on for this whole workflow to work automatically. 
This token can be generated in the general settings of the github account under settings/tokens and then needs to be copied into the secret. This token can only be generated by the owner of the repo.

1. **GitHub Secrets**:
   - `BSKY_HANDLE`: Bluesky handle
   - `BSKY_PASSWORD`: the app password for the bot
   - `GH_PAT`: GitHub personal access token (used for committing updates to `postedPapers.json`). 

Note, if you want to go back to run the bot manually you need to create an .env file with the passwords and the handle, see the template for reference.

2. **Dependencies**:

The .nvmrc file defines which Node.js version is used for the GitHub Actions (via the actions/setup-node step). If this version becomes outdated, it can be changed there. 
	
---

## GitHub Actions Automation

This bot runs automatically on GitHub, thanks to a workflow defined in `.github/workflows/post.yml`.

### How to think about this

You can think of GitHub Actions as your automated helper, which runs the bot automatically.	It checks for new papers, posts them, and updates tracking files on a schedule.
It keeps working in the background as long as the workflow is enabled and the GitHub secrets are correctly set.

If you want to apply or adjust this:
YOu can change the **posting frequency** by editing the `cron` schedule in `post.yml` or Update the **Bluesky account or credentials** by changing the GitHub Secrets.

---

### Workflow details

- **Schedule**: runs every 30 minutes (`*/30 * * * *`)
  
- **What it does** (each run):
  1. Checks out the repository (with permission to push changes)
  2. Installs Node.js and dependencies
  3. Builds and runs the bot
  4. Updates the `postedPapers.json` file if new papers were posted
  5. Commits the updated file back to the repository to maintain state

---

## Maintenance Tips

- To **reset posted tracking**, delete or clear `postedPapers.json`
- To **adjust post limits**, edit `MAX_POSTS_PER_RUN` in `getPostText.ts`. Note, there is a limit of posts one can post on Bluesky I think and therefore when it tries to post too many the Github Action fails and it then posts the same papers again and again because the action only posts them but it fails to then continue and store them as posted. Also, there is a character limit per post which is also handeled.
- To **change the feed**, update the `FEED_URL` in `getPostText.ts`
- To **change the posting frequency**, edit the `cron` schedule in `.github/workflows/post.yml`
- To **change the Bluesky account details**, update the GitHub Secrets
- To **transfer the repository**, make the new owner a collaborator and then create a new token from their account. I guess there are other solutions.